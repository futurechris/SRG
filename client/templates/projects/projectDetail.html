<template name="projectDetail">
	{{ #if allowedToView _public }}

	<div class="well">
		<div class="col-xs-3 pull-right">
			<center>
			<div style="margin: 0px 0px 10px 0px">Changelog</div>
			{{ >heatmap }}
			</center>
		</div>

		<h1>{{ _name }}</h1>
		{{#unless _public}}
			(Private)
		{{/unless}}
		{{ #if currentUser }}
			<div>
				<button class="editProject" data-slug="{{_slug}}">Edit/Update Project</button>
			</div>
		{{ /if }}
		{{ #markdown }}{{ _desc }}{{ /markdown }}
		<div class="well">
			<ul>
			{{ #each existingfeaturearray this }}
				{{ > displayfeature }}
			{{ /each }}
			</ul>
		</div>
		<div class="well col-xs-12">
			<h4>Activity</h4>
			{{ #if currentUser }}
				{{ >addLogEntry this }}
			{{ /if }}
			{{ #each projectActivity this 3 }}
			  {{ >logEntry }}
			{{ /each }}
		</div>
	</div>
	{{ else }}
		{{ > postfeed }}
	{{ /if }}
</template>

<template name="displayfeature">
	<div>
		<li>{{ _feat }}</li>
	</div>
</template>

<template name="logEntry">
	<div>
		{{ #if editingEntry this }}
			<div class="logSummaryDatePair">
				<form role="form" class="form-horizontal">
					<input type="hidden" name="projectid" value="{{ ../_id }}">
					<input type="hidden" name="activityid" value="{{ _id }}">
					<div class="form-group">
						<label class="control-label col-sm-2">Date:</label>
						<div class="col-sm-3">
							<input type="text" name="activitydate" class="form-control datepicker" value="{{_date}}" required>
						</div>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-2">Summary:</label>
						<div class="col-sm-10">
							<input type="text" name="activitysummary" class="form-control" placeholder="Activity Summary" value="{{ _summary }}" required>
						</div>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-2">Description:</label>
						<div class="col-sm-10">
							<textarea id="activitydesc" name="activitydesc" class="form-control" rows="5" resize="vertical" style="resize:vertical" placeholder="Activity Description" value="{{_desc}}" required></textarea>
						</div>
					</div>
					<div>
						<button class="col-sm-offset-2 displayPreview" value="desc{{_id}}">Preview Description</button>
						<button class="col-sm-offset-2 cancelEdit" value="{{_id}}">Cancel</button>
						<button type="submit" class="col-sm-offset-2 submitEditActivity pull-right" value="desc{{_id}}">Submit</button>
					</div><br/>

					<!-- Odd to include this as a form element :) -->
					<div class="form-group">
						<label class="control-label col-sm-2">Preview:</label>
						<div class="col-sm-10 well">
							{{ #markdown }}{{ getDescriptionMarkdown }}{{ /markdown }}
						</div>
					</div>
				</form>
				
			</div>
		{{ else }}
			<div class="logSummaryDatePair">
				<span class="logSummary">{{ _summary }}</span>
				<button class="editEntry activityLogBtn" value="{{_id}}">Edit</button>
				<span class="logDate">{{ _date }}</span>
			</div>
			{{ #markdown }}{{ _desc }}{{ /markdown }}
		{{ /if }}
	</div>
</template>

<template name="addLogEntry">
	<div>
		<form role="form" class="form-horizontal">
			<input type="hidden" name="projectid" value="{{ ../_id }}">

			<div class="form-group">
				<label class="control-label col-sm-2">Date:</label>
				<div class="col-sm-3">
					<input type="text" name="activitydate" class="form-control datepicker" required>
				</div>
			</div>

			<div class="form-group">
				<label class="control-label col-sm-2">Summary:</label>
				<div class="col-sm-10">
					<input type="text" name="activitysummary" class="form-control" placeholder="Activity Summary" required>
				</div>
			</div>

			<div class="form-group">
				<label class="control-label col-sm-2">Description:</label>
				<div class="col-sm-10">
					<textarea id="activitydesc" name="activitydesc" class="form-control" rows="5" resize="vertical" style="resize:vertical" placeholder="Activity Description" required></textarea>
				</div>
			</div>
			<div>
				<button class="col-sm-offset-2 displayPreview">Preview Description</button>
				<button type="submit" class="col-sm-offset-2 submitActivity pull-right">Submit</button>
			</div><br/>

			<!-- Odd to include this as a form element :) -->
			<div class="form-group">
				<label class="control-label col-sm-2">Preview:</label>
				<div class="col-sm-10 well">
					{{ #markdown }}{{ getDescriptionMarkdown }}{{ /markdown }}
				</div>
			</div>
		</form>
	</div>
</template>

<template name="heatmap">
	<div id="cal-heatmap"></div>
	<script type="text/javascript">
		var cal = new CalHeatMap();
		var date = new Date();
		date.setMonth(date.getMonth()-1);
		cal.init({
				itemSelector: "#cal-heatmap",
				domain: "month",
				subDomain: "x_day",
				cellSize: 14,
				subDomainTextFormat: "%d",
				range: 2,
				start: date,
				displayLegend: false,
				verticalOrientation: true,
				label: {
					offset: { x: 0, y: -5 },
					height: 10
				}
		});
	</script>
</template>